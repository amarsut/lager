/* =================================================================
   MODALS.CSS - MASTER VERSION
   Struktur:
   1. Globala inställningar (Backdrop, Content, Header)
   2. UI Komponenter (Inputs, Knappar, Badges)
   3. Specifika Modaler (Jobb, Fordon, Kund, Chatt)
   4. Desktop-anpassningar (Min-width: 769px)
   5. Mobil-anpassningar (Max-width: 768px)
   ================================================================= */

/* =========================================
   1. GLOBALA INSTÄLLNINGAR
   ========================================= */

.modal-backdrop {
    position: fixed; top: 0; left: 0; width: 100%; height: 100%;
    background: rgba(0,0,0,0.5); 
    display: none; 
    align-items: center; justify-content: center; 
    z-index: 100;
    backdrop-filter: blur(2px);
}

.modal-backdrop.show {
    display: flex;
}

/* Grunddesign för modal-fönstret */
.modal-content {
    background-color: #ffffff;
    border-radius: 12px;
    box-shadow: 0 10px 25px rgba(0,0,0,0.2);
    position: relative;
    display: flex;
    flex-direction: column;
    width: 100%;
    max-width: 550px;
    height: auto;
    max-height: 85vh;
    margin: auto;
    overflow: hidden; /* Viktigt för rundade hörn */
}

/* -- Header -- */
.modal-header {
    display: flex;
    align-items: center;
    justify-content: flex-start; /* Vänsterställd titel */
    gap: 12px;
    
    background-color: #ffffff;
    border-bottom: 1px solid #e5e7eb;
    padding: 0 16px;
    height: 60px;
    flex-shrink: 0;
}

.modal-header h2,
#vehicleRegTitle { 
    margin: 0;
    font-size: 1.1rem;
    font-weight: 700;
    color: #111;
    line-height: 1;
}

/* -- Body -- */
.modal-body {
    flex: 1;
    overflow-y: auto;
    padding: 20px 16px;
    -webkit-overflow-scrolling: touch;
    background-color: #ffffff; /* Standard vit */
}

/* -- Footer / Actions -- */
.modal-actions {
    display: flex;
    justify-content: flex-end;
    gap: 10px;
    padding: 16px 24px;
    background-color: #ffffff;
    border-top: 1px solid #f3f4f6;
    flex-shrink: 0;
}

/* Tillbaka-pilen */
.simple-back-btn,
.messenger-back-btn {
    background: transparent; border: none; padding: 0;
    width: 36px; height: 36px;
    display: flex; align-items: center; justify-content: flex-start; /* Vänsterjusterad */
    color: #111; cursor: pointer; flex-shrink: 0;
}
.simple-back-btn svg { width: 24px; height: 24px; stroke-width: 2.5px; }


/* =========================================
   2. UI KOMPONENTER
   ========================================= */

/* -- Inputs -- */
.form-group { margin-bottom: 16px; display: flex; flex-direction: column; width: 100%; }
.form-group label { margin-bottom: 8px; font-weight: 600; font-size: 0.85rem; color: #374151; }

.input-gray, select, textarea {
    width: 100%;
    padding: 12px 16px;
    border: none;
    background-color: #F3F4F6;
    border-radius: 8px;
    font-size: 0.95rem;
    color: #1f2937;
    outline: none;
    font-family: inherit;
    box-sizing: border-box;
}
.input-gray:focus { background-color: #E5E7EB; box-shadow: 0 0 0 2px rgba(0,0,0,0.05); }

/* Copy Button in Input */
.input-wrapper-copy { position: relative; display: flex; align-items: center; width: 100%; }
.input-wrapper-copy input { padding-right: 40px; }
.btn-copy-input {
    position: absolute; right: 8px; background: transparent; border: none;
    color: #9ca3af; cursor: pointer; padding: 4px;
}

/* -- Knappar -- */
.button { padding: 0 20px; height: 40px; border-radius: 8px; font-weight: 600; border: none; cursor: pointer; display: flex; align-items: center; justify-content: center; font-size: 0.9rem; }
.button.primary-solid { background-color: #0066FF; color: white; }
.button.secondary-outline { background-color: white; border: 1px solid #e5e7eb; color: #374151; }
.button-outline-sm {
    padding: 0 16px; height: 42px; border: 1px solid #e5e7eb; background: white;
    border-radius: 8px; font-weight: 600; cursor: pointer; display: flex; align-items: center; gap: 6px;
}

/* -- Listor & Helpers -- */
.form-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 16px; }
.full-width { grid-column: span 2; }
.icon-sm { width: 18px; height: 18px; }
.money-related { font-family: monospace; font-weight: 600; }


/* =========================================
   3. SPECIFIKA MODALER (Innehåll)
   ========================================= */

/* --- JOBB MODAL (Ekonomi & Formulär) --- */
.expense-section {
    margin-top: 16px; padding-top: 16px; border-top: 1px solid #f3f4f6;
    margin-bottom: 24px; padding-bottom: 24px; border-bottom: 1px solid #f3f4f6;
}
.expense-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px; }
.expense-list { margin-bottom: 12px; }
.expense-item {
    display: flex; justify-content: space-between; align-items: center;
    padding: 8px 12px; background: #fff; border: 1px solid #e5e7eb; border-radius: 6px; margin-bottom: 6px;
}
.expense-input-row { display: grid; grid-template-columns: 2fr 1fr auto; gap: 10px; align-items: center; }
.btn-remove-expense { background: none; border: none; color: #ef4444; font-size: 1.2rem; cursor: pointer; }

/* --- KUND & FORDON (Gemensam stil: Helvit & Platt) --- */
.customer-section {
    padding: 16px 0;
    background: #fff;
    border-bottom: 1px solid #e2e8f0;
}
.customer-section:last-child { border-bottom: none; }
.section-title { font-size: 0.75rem; font-weight: 800; color: #94a3b8; text-transform: uppercase; margin: 0 0 12px 0; }

/* Statistik-raden (Kund) */
.customer-stats-row {
    display: grid; grid-template-columns: 1fr 1fr 1fr;
    background: #fff; padding: 16px 0; border-bottom: 1px solid #e2e8f0;
}
.c-stat-box { display: flex; flex-direction: column; align-items: center; gap: 2px; }
.c-stat-label { font-size: 0.65rem; color: #94a3b8; font-weight: 700; text-transform: uppercase; }
.c-stat-value { font-size: 1.1rem; font-weight: 800; color: #0f172a; }

/* Garage Chips */
.vehicle-chips-container { display: flex; flex-wrap: wrap; gap: 6px; }
.v-chip {
    background: #fff; border: 1px solid #e2e8f0; padding: 6px 10px; border-radius: 20px;
    font-size: 0.85rem; font-weight: 600; color: #1e293b; cursor: pointer; display: flex; align-items: center;
}
.v-chip img { width: 14px; height: 14px; margin-right: 6px; }

/* Historiklista (Tidslinje) */
.history-list-clean {
    position: relative; padding-left: 20px; border-left: 2px solid #e2e8f0; margin-left: 8px; margin-top: 10px;
}
.history-item-clean {
    position: relative; display: grid; grid-template-columns: 1fr auto; gap: 12px;
    padding: 12px 0; border-bottom: 1px solid #f1f5f9; cursor: pointer;
}
.history-item-clean::before {
    content: ''; position: absolute; left: -26px; top: 18px;
    width: 10px; height: 10px; background: #e2e8f0; border: 2px solid #fff; border-radius: 50%;
}
.h-date { font-size: 0.85rem; font-weight: 700; color: #1e293b; }
.h-desc-text { font-size: 0.8rem; color: #64748b; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
.h-price { font-size: 0.9rem; font-weight: 700; color: #10b981; }

/* --- TEKNISK DATA (Listan) --- */
.tech-header-main { display: flex; align-items: center; gap: 12px; margin-bottom: 16px; }
.brand-icon-svg { width: 28px; height: 28px; color: #111; }

/* Listan anpassas i Media Queries (Grid vs Flex) */
ul.tech-list { padding: 0; margin: 0; list-style: none; }
.spec-label-col { display: flex; align-items: center; gap: 6px; color: #64748b; }
.spec-value-col { display: flex; align-items: center; overflow: hidden; }
.spec-input { border: none; background: transparent; width: 100%; outline: none; color: #0f172a; font-weight: 500; font-size: 0.85rem; }

/* Header Actions (Fordon) */
.header-actions { display: flex; align-items: center; gap: 8px; }
.header-icon-action {
    width: 36px; height: 36px; border-radius: 8px; border: 1px solid #e2e8f0;
    background: #fff; display: flex; align-items: center; justify-content: center;
}

/* Sökfält i Historik */
.history-search-wrapper { position: relative; margin-bottom: 16px; }
.history-search-wrapper input { padding-left: 40px !important; }
.history-search-wrapper .search-icon { position: absolute; left: 12px; top: 50%; transform: translateY(-50%); width: 18px; color: #9ca3af; z-index: 10; }


/* =========================================
   4. DESKTOP-ANPASSNING (Min-width: 769px)
   ========================================= */
@media (min-width: 769px) {
    
    /* Centrera och begränsa storlek */
    .modal-backdrop { align-items: center; padding-top: 0; }
    
    #customerModal .modal-content, 
    #vehicleModal .modal-content,
    #jobModal .modal-content {
        width: 600px;
        max-width: 90vw;
        height: auto;
        max-height: 85vh;
        border-radius: 12px;
        box-shadow: 0 15px 40px rgba(0,0,0,0.2);
    }

    /* Footer - knappar till höger */
    .modal-actions { justify-content: flex-end; width: 100%; border-top: 1px solid #e2e8f0; }
    .modal-actions button { width: auto; min-width: 100px; }

    /* Inputs - Kompaktare padding på dator */
    .input-gray, select { padding: 10px 12px; font-size: 0.9rem; }

    /* Teknisk Data - Grid 2 Kolumner */
    ul.tech-list {
        display: grid; grid-template-columns: 1fr 1fr; gap: 8px;
    }
    ul.tech-list li {
        display: flex; align-items: stretch; background: #fff; border: 1px solid #e2e8f0; border-radius: 4px; min-height: 34px;
    }
    .spec-label-col {
        width: 85px; flex-shrink: 0; background: #f8fafc; border-right: 1px solid #e2e8f0; padding: 0 8px; font-size: 0.75rem; font-weight: 600;
    }
    .spec-value-col { flex-grow: 1; padding: 0 10px; background: #fff; }
}


/* =========================================
   5. MOBIL-ANPASSNING (Max-width: 768px)
   Här samlas ALLA mobilfixar
   ========================================= */
@media (max-width: 768px) {

    /* --- LAYOUT & FULLSKÄRM --- */
    
    /* 1. Modal Container (Täcker allt) */
    .modal-content {
        width: 100% !important;
        height: 100dvh !important;
        max-width: none !important;
        max-height: none !important;
        border-radius: 0 !important;
        margin: 0 !important;
        display: flex !important; 
        flex-direction: column !important;
    }

    /* 2. Z-Index Hierarki (Viktigt!) */
    #customerModal.show { z-index: 200001 !important; } /* Lägst */
    #vehicleModal.show  { z-index: 200005 !important; } /* Över kund */
    #jobModal           { z-index: 300000 !important; } /* Överst */
    
    /* Se till att modalen börjar i toppen */
    #customerModal.show, #vehicleModal.show, #jobModal.show {
        top: 0 !important;
        padding: 0 !important;
        align-items: flex-start !important;
    }

    /* --- HEADER & BODY --- */
    
    .modal-header {
        padding: 0 16px !important;
        min-height: 60px !important;
        background: #fff !important;
        position: sticky !important; top: 0; z-index: 50;
    }
    
    .modal-body {
        padding: 16px !important;
        padding-bottom: 120px !important; /* Plats för footer */
    }
    
    /* --- FOOTER (ACTION BAR) --- */
    
    .modal-actions {
        position: fixed !important;
        bottom: 0 !important; left: 0 !important; right: 0 !important;
        background: #fff !important;
        border-top: 1px solid #e2e8f0 !important;
        padding: 12px 16px !important;
        padding-bottom: max(12px, env(safe-area-inset-bottom)) !important;
        z-index: 99 !important;
        display: flex !important; 
        gap: 12px !important;
    }
    
    /* Knappar på mobil: Stora och tydliga */
    .modal-actions button {
        flex: 1 !important; /* Båda knapparna tar lika stor plats */
        height: 48px !important;
        font-size: 1rem !important;
    }

    /* --- MODAL SPECIFIKT: KUND --- */
    #customerModal .modal-body { background-color: #fff !important; padding: 0 !important; }
    #customerModal .customer-section { margin-bottom: 0 !important; padding: 20px 16px !important; }
    
    /* Grid för Kundlistan (Dashboard) */
    .customer-grid { display: flex !important; flex-direction: column !important; gap: 8px !important; }

    /* --- MODAL SPECIFIKT: FORDON --- */
    #vehicleModal .modal-body { background-color: #fff !important; padding: 0 !important; }
    .vehicle-header-row { margin: 0 !important; padding: 0 16px !important; height: 60px !important; }
    #vehicleRegTitle { font-size: 1.4rem !important; }
    
    /* Garage Chips (3 på rad) */
    .vehicle-chips-container { display: grid !important; grid-template-columns: 1fr 1fr 1fr !important; gap: 8px !important; }
    .v-chip { justify-content: center !important; width: 100% !important; padding: 8px 4px !important; text-align: center; }

    /* Teknisk Data (Mobil List-vy) */
    ul.tech-list { display: flex !important; flex-direction: column !important; border: 1px solid #e2e8f0; border-radius: 8px; overflow: hidden; margin: 0 16px; }
    ul.tech-list li { display: grid !important; grid-template-columns: 90px 1fr !important; border-bottom: 1px solid #f1f5f9; height: 40px; align-items: center; }
    .spec-label-col { background: #f8fafc; height: 100%; border-right: 1px solid #e2e8f0; padding-left: 12px; }
    .spec-value-col { padding-left: 12px; }

    /* --- MODAL SPECIFIKT: JOBB (Formulär) --- */
    #jobModalForm .form-group { margin-bottom: 16px !important; }
    #jobModalForm input, #jobModalForm select { height: 48px !important; font-size: 16px !important; /* 16px förhindrar zoom på iPhone */ }
    #btnAddExpense { width: 48px !important; font-size: 0 !important; padding: 0 !important; } /* Bara plus-ikon */
    
    /* --- CHATT WIDGET (Helskärm) --- */
    .chat-widget {
        position: fixed !important; top: 0; left: 0; width: 100%; height: 100dvh;
        z-index: 300000 !important; background: #fff;
    }
    .chat-input-area textarea { min-height: 44px !important; padding-right: 80px !important; }
    #chatSendBtn { width: 44px !important; height: 44px !important; }
}
