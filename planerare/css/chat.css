/* ==========================================================================
   MODERN CHAT - PREMIUM DESIGN (UPDATED)
   ========================================================================== */

/* --- 1. Flytande Chatt-knapp (FAB) --- */
@media (min-width: 769px) {
    #fabChat {
        position: fixed !important;
        bottom: 30px !important;
        right: 30px !important;
        width: 60px !important;
        height: 60px !important;
        background-color: #0066FF !important; /* Huvudfärg */
        color: white !important;
        border-radius: 50% !important;
        border: none !important;
        box-shadow: 0 4px 12px rgba(0,0,0,0.3) !important;
        z-index: 2147483647 !important;
        display: flex !important;
        align-items: center;
        justify-content: center;
        cursor: pointer !important;
        transition: transform 0.2s, box-shadow 0.2s;
    }
    #fabChat:hover {
        transform: translateY(-3px) scale(1.05) !important;
        box-shadow: 0 15px 35px -8px rgba(59, 130, 246, 0.7) !important;
    }
}
@media (max-width: 768px) {
    #fabChat { display: none !important; }
}

/* --- 2. Huvudfönster (Widget) --- */
.chat-widget {
    position: fixed;
    bottom: 105px; 
    right: 30px;
    width: clamp(400px, 40vw, 500px); 
    height: 600px;
    max-height: 80vh;
    /* Glassmorphism bakgrund */
    background: rgba(255, 255, 255, 0.85) !important;
    backdrop-filter: blur(20px) saturate(180%);
    -webkit-backdrop-filter: blur(20px) saturate(180%);
    border: 1px solid rgba(255, 255, 255, 0.3);
    border-radius: 24px;
    box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25), 0 0 0 1px rgba(0,0,0,0.05);
    display: flex; 
    flex-direction: column;
    z-index: 1000;
    overflow: hidden;
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
    animation: chatPopIn 0.35s cubic-bezier(0.16, 1, 0.3, 1) forwards;
}

@keyframes chatPopIn {
    from { opacity: 0; transform: translateY(30px) scale(0.96); }
    to { opacity: 1; transform: translateY(0) scale(1); }
}

/* --- 3. Header (Centrerad & Balanserad) --- */
.chat-header {
    height: 60px;
    padding: 0 12px; /* Luft på sidorna */
    background: rgba(255, 255, 255, 0.8) !important;
    border-bottom: 1px solid rgba(0,0,0,0.05) !important;
    backdrop-filter: blur(10px);
    
    /* Flexbox för att centrera vertikalt */
    display: flex !important;
    align-items: center !important; 
    justify-content: flex-start !important; /* Starta från vänster */
    gap: 10px !important; /* Avståndet mellan pilen och sökfältet */
    
    flex-shrink: 0;
    z-index: 10;
}

/* Back-knapp (Pilen) */
#closeChatWidget {
    width: 40px !important; 
    height: 40px !important;
    background: transparent !important;
    border: none !important;
    border-radius: 50%; /* Gör hover-effekten rund */
    
    /* Centrera ikonen i knappen */
    display: flex !important; 
    align-items: center !important; 
    justify-content: center !important;
    
    color: #1C1C1E; 
    cursor: pointer; 
    flex-shrink: 0;
    padding: 0 !important;
    margin: 0 !important;
    transition: background 0.2s;
}
#closeChatWidget:hover { background: rgba(0,0,0,0.05) !important; }

/* Sökfält Wrapper - Tar upp all plats i mitten */
.chat-search-wrapper {
    flex: 1 !important;        /* Väx för att fylla bredden */
    height: 40px !important;   /* Lås höjden till samma som knappen */
    max-width: 100%;
    position: relative !important;
    display: flex !important;
    align-items: center !important; /* Centrera innehållet vertikalt */
}

/* Själva textfältet */
.chat-search-wrapper input {
    width: 100% !important;
    height: 100% !important;   /* Fyller wrappern (40px) */
    padding: 0 12px 0 38px !important; /* Plats för vänster ikon */
    padding-right: 80px !important;    /* Plats för höger ikoner */
    margin: 0 !important;
    
    border: none !important;
    border-radius: 20px !important; /* Lite rundare hörn för mjukare look */
    font-size: 0.95rem !important;
    background: rgba(118, 118, 128, 0.12) !important; /* Apple-grå */
    color: #1C1C1E !important;
    outline: none !important;
    font-family: inherit;
}
.chat-search-wrapper input:focus { background: rgba(118, 118, 128, 0.18) !important; }

/* Sökikon (Vänster) */
.search-icon-inside {
    position: absolute !important; 
    left: 12px !important; 
    top: 50% !important; 
    transform: translateY(-50%) !important;
    width: 18px !important; 
    height: 18px !important; 
    color: #8E8E93 !important; 
    pointer-events: none;
}

/* Verktyg (AI & Galleri) inuti sökfältet (Höger) */
.inside-search-tools {
    position: absolute !important;
    right: 8px !important; /* Lite luft från kanten */
    top: 50% !important;
    transform: translateY(-50%) !important;
    height: 28px !important; /* Begränsad höjd så de passar i input */
    display: flex !important;
    align-items: center !important;
    gap: 2px !important;
    z-index: 10 !important;
}

.tool-icon-btn {
    background: transparent !important; 
    border: none !important; 
    width: 28px !important; 
    height: 28px !important; 
    padding: 0 !important;
    cursor: pointer; 
    color: #666;
    display: flex !important; 
    align-items: center; 
    justify-content: center;
    border-radius: 50%;
}
.tool-icon-btn:hover { background: rgba(0,0,0,0.05) !important; color: #000; }
.tool-icon-btn svg { width: 18px; height: 18px; }

.tool-divider { 
    width: 1px !important; 
    height: 16px !important; 
    background: rgba(0,0,0,0.15) !important; 
    margin: 0 4px !important; 
}

/* --- 4. Meddelandelista --- */
.chat-messages {
    flex: 1;
    overflow-y: auto;
    padding: 20px 20px 10px 20px;
    display: flex; flex-direction: column;
    gap: 8px;
    scrollbar-width: thin; scrollbar-color: #D1D1D6 transparent;
}

/* Datumavskiljare */
.chat-date-separator {
    text-align: center; font-size: 0.7rem; color: #8E8E93; font-weight: 600;
    margin: 12px 0; text-transform: uppercase; letter-spacing: 0.5px;
    position: relative; display: flex; align-items: center; justify-content: center;
}
.chat-date-separator span { background: rgba(255,255,255,0.8); padding: 0 10px; z-index: 1; border-radius: 10px; }
.chat-date-separator::before {
    content: ''; position: absolute; left: 0; right: 0; top: 50%; 
    height: 1px; background: rgba(0,0,0,0.05); z-index: 0;
}

/* --- 5. Bubblor --- */
.chat-row {
    display: flex; flex-direction: column; max-width: 80%;
    position: relative; margin-bottom: 20px;
    animation: messagePopIn 0.3s cubic-bezier(0.25, 1, 0.5, 1) forwards;
}
.chat-row:last-child { margin-bottom: 0; }

@keyframes messagePopIn {
    from { opacity: 0; transform: translateY(15px) scale(0.98); }
    to { opacity: 1; transform: translateY(0) scale(1); }
}

.chat-row.me { align-self: flex-end; align-items: flex-end; }
.chat-row.other, .chat-row.system { align-self: flex-start; align-items: flex-start; }

.chat-bubble {
    padding: 10px 16px; 
    font-size: 0.95rem; line-height: 1.45; position: relative;
    word-wrap: break-word; 
    box-shadow: 0 1px 2px rgba(0,0,0,0.05);
}

/* Mina bubblor (Blå gradient) */
.chat-row.me .chat-bubble {
    background: linear-gradient(135deg, #0066FF 0%, #0052cc 100%) !important;
    box-shadow: 0 4px 15px rgba(0, 102, 255, 0.3);
    color: white;
    border-radius: 20px 20px 4px 20px !important;
}
.chat-row.me .chat-bubble a { color: white; text-decoration: underline; }

/* Andras bubblor (Grå/Vit) */
.chat-row.other .chat-bubble, .chat-row.system .chat-bubble {
    background: linear-gradient(135deg, #FFFFFF 0%, #F3F4F6 100%) !important;
    color: #111827 !important;
    box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05) !important;
    border-radius: 20px 20px 20px 4px !important;
}

/* Bildbubblor */
.chat-bubble.is-image { background: transparent !important; padding: 0 !important; box-shadow: none !important; }
.chat-bubble-image img {
    border-radius: 18px; max-width: 100%; max-height: 300px;
    display: block; cursor: zoom-in; box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    transition: transform 0.2s;
}
.chat-bubble-image img:hover { transform: scale(1.02); }

/* Tidsstämpel */
.chat-time {
    font-size: 11px; color: #9CA3AF; margin-top: 4px; font-weight: 400; opacity: 0.8;
}
.chat-row.me .chat-time { text-align: right; margin-right: 4px; }
.chat-row.other .chat-time { text-align: left; margin-left: 4px; }

/* Highlight vid sök */
.search-highlight { background-color: #ffeb3b; color: #000; border-radius: 2px; }

/* --- 6. Input Area (Botten) --- */
.chat-input-area {
    background: rgba(255, 255, 255, 0.8) !important;
    backdrop-filter: blur(20px);
    border-top: 1px solid rgba(0,0,0,0.05) !important;
    padding: 10px !important;
    padding-bottom: max(10px, env(safe-area-inset-bottom)) !important;
    display: flex !important;
    flex-direction: column !important;
}

.chat-bottom-row {
    display: flex !important; align-items: flex-end !important;
    gap: 8px !important; width: 100% !important; position: relative !important;
}

/* Input Wrapper (Mitten) */
.input-wrapper {
    flex: 1 !important;
    background-color: #f0f2f5 !important;
    border-radius: 20px !important;
    position: relative !important;
    min-height: 40px !important;
    display: flex !important; align-items: center !important;
    border: 1px solid transparent !important;
    transition: border 0.2s, background 0.2s !important;
}
.input-wrapper:focus-within {
    border-color: #0066FF !important; background-color: #fff !important;
}

#chatInput {
    width: 100% !important; background: transparent !important;
    border: none !important; box-shadow: none !important;
    padding: 10px 12px !important; 
    padding-right: 75px !important; /* Plats för ikoner */
    margin: 0 !important; 
    
    /* Font inställningar */
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif !important;
    font-size: 16px !important; 
    line-height: 1.4 !important;
    color: #000 !important;

    max-height: 120px !important; resize: none !important; min-height: 40px !important;
}

/* Ikoner inuti input (Höger) - FIXAD STORLEK */
.icons-inside-right {
    position: absolute !important; 
    right: 8px !important; 
    top: 50% !important;            /* Centrera vertikalt */
    transform: translateY(-50%) !important; 
    display: flex !important; 
    gap: 2px !important; 
    height: 32px !important;
    align-items: center !important; 
    z-index: 10 !important;
}

.icon-btn-small {
    background: transparent !important; border: none !important;
    width: 32px !important; height: 32px !important;
    min-width: 32px !important; /* Förhindrar att den trycks ihop */
    padding: 6px !important;    /* Luft runt ikonen */
    color: #8E8E93 !important; 
    display: flex !important; align-items: center; justify-content: center !important;
    cursor: pointer !important;
}
.icon-btn-small:hover { color: #0066FF !important; }

/* Tvinga SVG storlek så de inte blir jättestora */
.icon-btn-small svg {
    width: 20px !important;
    height: 20px !important;
    min-width: 20px !important;
    min-height: 20px !important;
    stroke-width: 2px !important;
}

/* Skicka Knapp (Höger) */
.send-btn-round {
    width: 40px !important; height: 40px !important;
    background-color: #0066FF !important; /* Alltid blå */
    border-radius: 50% !important; border: none !important;
    color: white !important;
    display: flex !important; align-items: center; justify-content: center !important;
    flex-shrink: 0 !important; cursor: pointer;
    box-shadow: 0 4px 12px rgba(0, 102, 255, 0.3);
    transition: all 0.2s cubic-bezier(0.34, 1.56, 0.64, 1);
}
/* Ikonen inuti är alltid vit */
.send-btn-round svg {
    width: 20px !important; height: 20px !important;
    stroke: white !important;
    transition: transform 0.2s;
}

/* Hover/Active effekter */
.send-btn-round:hover { transform: scale(1.05); box-shadow: 0 6px 15px rgba(0, 102, 255, 0.4); }
.send-btn-round:active { transform: scale(0.95); }

/* (Valfritt) Om du vill att den ska se inaktiv ut när fältet är tomt,
   men ändå vara blå, kan du sänka opaciteten.
   Ta bort detta block om du vill att den alltid ska se likadan ut. */
.send-btn-round:disabled,
.send-btn-round:not(.is-active) {
   opacity: 0.6; /* Lite genomskinlig om inaktiv */
   cursor: default;
   box-shadow: none;
   transform: none !important;
}

/* --- 7. Menyn för meddelanden (Högerklick/Hover) --- */
.chat-action-menu {
    display: none; position: absolute; top: -45px;
    background-color: rgba(255, 255, 255, 0.95);
    backdrop-filter: blur(8px); border: 1px solid rgba(0,0,0,0.08);
    border-radius: 30px; padding: 6px 10px;
    box-shadow: 0 8px 20px rgba(0,0,0,0.12);
    align-items: center; gap: 6px; z-index: 2000;
    animation: popInMenu 0.2s cubic-bezier(0.175, 0.885, 0.32, 1.275);
}
.chat-row.me .chat-action-menu { right: 0; }
.chat-row.other .chat-action-menu { left: 0; }
.chat-row:hover .chat-action-menu, .chat-row.show-menu .chat-action-menu { display: flex; }
.chat-row:hover, .chat-row.show-menu { z-index: 100; } /* Lyfter raden över datum */

.action-emoji-btn, .action-icon-btn {
    background: transparent; border: none; cursor: pointer;
    display: flex; align-items: center; justify-content: center;
    transition: transform 0.2s;
}
.action-emoji-btn { font-size: 1.3rem; width: 32px; height: 32px; border-radius: 50%; }
.action-emoji-btn:hover { transform: scale(1.2); background: rgba(0,0,0,0.05); }

.action-icon-btn { color: #64748b; width: 32px; height: 32px; border-radius: 50%; }
.action-icon-btn:hover { background: #f1f5f9; color: #007aff; }
.action-icon-btn.danger:hover { background: #fef2f2; color: #ef4444; }
.action-separator { width: 1px; height: 20px; background: #e5e5ea; margin: 0 4px; }

/* Reaktioner (liten ikon på bubblan) */
.reaction-badge-display {
    position: absolute; bottom: -6px; right: -6px;
    background: #fff; border: 2px solid #fff; border-radius: 12px;
    padding: 2px 5px; font-size: 0.85rem; cursor: pointer;
    box-shadow: 0 2px 6px rgba(0,0,0,0.1); z-index: 10;
    animation: popInBadge 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
}
.chat-row.other .reaction-badge-display { right: auto; left: 0px; }

@keyframes popInBadge { from { transform: scale(0); } to { transform: scale(1); } }
@keyframes popInMenu { from { opacity: 0; transform: translateY(10px) scale(0.9); } to { opacity: 1; transform: translateY(0) scale(1); } }

/* --- 8. BILD ZOOM MODAL (PREMIUM & MODERN MOBIL) --- */
.image-modal-overlay {
    display: none; /* JS ändrar till flex */
    position: fixed;
    top: 0; left: 0; right: 0; bottom: 0;
    z-index: 2147483647 !important;
    background: rgba(0, 0, 0, 0.92); /* Mycket mörk bakgrund för fokus */
    backdrop-filter: blur(8px);
    -webkit-backdrop-filter: blur(8px);
    flex-direction: column;
    align-items: center; justify-content: center;
    animation: fadeInModal 0.25s ease-out forwards;
}

@keyframes fadeInModal { from { opacity: 0; } to { opacity: 1; } }

.image-modal-content {
    position: relative; width: 100%; height: 100%;
    display: flex; align-items: center; justify-content: center;
    /* Padding så bilden inte nuddar menyn på desktop */
    padding: 40px 20px 100px 20px;
}

#mmImgMain {
    max-width: 95vw; max-height: 85vh;
    object-fit: contain;
    border-radius: 8px;
    box-shadow: 0 20px 60px rgba(0,0,0,0.5);
    transform: scale(0.96);
    animation: zoomInImage 0.3s cubic-bezier(0.2, 0.9, 0.4, 1.1) forwards;
    transition: transform 0.3s;
}
@keyframes zoomInImage { to { transform: scale(1); } }

/* --- DESKTOP VERKTYGSFÄLT (Pillret) --- */
.image-modal-toolbar.glass-pill {
    position: absolute; bottom: 40px; z-index: 10;
    display: flex; align-items: center;
    background: rgba(30, 30, 30, 0.85); /* Mörkare */
    backdrop-filter: blur(20px); -webkit-backdrop-filter: blur(20px);
    border: 1px solid rgba(255,255,255,0.1);
    border-radius: 100px; padding: 6px;
    box-shadow: 0 15px 35px rgba(0,0,0,0.3);
}

.toolbar-btn {
    background: transparent; border: none; color: rgba(255,255,255,0.9);
    padding: 10px 20px; font-size: 0.9rem; font-weight: 600;
    display: flex; align-items: center; gap: 10px;
    cursor: pointer; border-radius: 100px; transition: all 0.2s;
}
.toolbar-btn:hover { background: rgba(255,255,255,0.15); color: white; }
.toolbar-btn svg { width: 22px; height: 22px; stroke-width: 2px; }

.toolbar-divider {
    width: 1px; height: 24px; background: rgba(255,255,255,0.2); margin: 0 4px;
}

.text-red { color: #ff5f57; }
.text-red:hover { background: rgba(255, 95, 87, 0.15); color: #ff5f57; }


/* =================================================================
   MOBILANPASSNING - SAMSUNG ONE UI STYLE (FIXAD BLUR & ID-PRIO)
   ================================================================= */
@media (max-width: 768px) {
    
    /* 1. BAKGRUND (Använder ID för att tvinga igenom stilen) */
    #imageZoomModal {
        /* 45% svart - resten genomskinligt för att släppa igenom bakgrunden */
        background-color: rgba(0, 0, 0, 0.45) !important;
        
        /* Kraftig oskärpa (Samsung style) */
        backdrop-filter: blur(15px) !important;
        -webkit-backdrop-filter: blur(15px) !important;
    }

    /* 2. BILDENS STORLEK & PLACERING */
    .image-modal-content {
        padding: 0 !important;
        width: 100% !important;
        height: 100% !important;
        display: flex !important;
        align-items: center !important;
        justify-content: center !important;
    }

    #mmImgMain {
        max-width: 100vw !important;
        /* Begränsad höjd ger "luft" och ser lyxigare ut */
        max-height: 70vh !important; 
        width: auto !important;
        
        /* Ingen border-radius eller skugga på mobil för renare look */
        border-radius: 0 !important;
        box-shadow: none !important; 
        object-fit: contain !important;
    }

    /* 3. DÖLJ DET GAMLA VERKTYGSFÄLTET */
    .image-modal-toolbar.glass-pill {
        position: static !important; width: 0 !important; height: 0 !important;
        padding: 0 !important; border: none !important; background: transparent !important;
        display: contents !important;
    }
    .toolbar-btn span, .toolbar-divider { display: none !important; }

    /* 4. KNAPPAR (Minimalistiska, utan bakgrundsplatta) */
    .toolbar-btn {
        position: fixed !important; 
        z-index: 99999 !important; /* Säkerställ att de ligger överst */
        background: transparent !important; 
        border: none !important;
        width: 60px !important; height: 60px !important; /* Stor träffyta */
        padding: 0 !important; margin: 0 !important;
        display: flex !important; align-items: center !important; justify-content: center !important;
    }

    /* --- STÄNG (Uppe till vänster - Tillbaka-pil) --- */
    #mmCloseBtn {
        top: calc(10px + env(safe-area-inset-top)) !important;
        left: 10px !important;
    }
    
    /* --- RADERA (Nere till höger - Samsung standard) --- */
    #mmDeleteBtn {
        bottom: calc(20px + env(safe-area-inset-bottom)) !important;
        right: 20px !important;
    }

    /* --- IKON-DESIGN --- */
    .toolbar-btn svg {
        width: 26px !important;
        height: 26px !important;
        stroke: #ffffff !important;     /* Kritvita ikoner */
        stroke-width: 1.5px !important; /* Tunna eleganta linjer */
        
        /* Liten skugga så ikonen syns även mot ljusa bilder */
        filter: drop-shadow(0 1px 3px rgba(0,0,0,0.5)) !important;
    }

    /* Tvinga radera-ikonen vit (tar bort eventuell röd färg) */
    #mmDeleteBtn svg { stroke: #ffffff !important; }

    /* Touch-effekt */
    .toolbar-btn:active { opacity: 0.6; transform: scale(0.92); transition: 0.1s; }
}

/* --- Mobilanpassning --- */
@media (max-width: 768px) {
    .chat-widget {
        top: 0 !important; left: 0 !important; right: 0 !important; bottom: 0 !important;
        width: 100% !important; height: 100% !important; max-height: none !important;
        border-radius: 0 !important; margin: 0 !important; z-index: 999999;
    }
    .chat-header {
        padding-top: max(10px, env(safe-area-inset-top));
        height: auto; min-height: 60px;
    }
    .chat-input-area { 
        padding-bottom: max(10px, env(safe-area-inset-bottom)) !important;
    }
    .image-modal-toolbar.glass-pill { bottom: 30px; }
    .toolbar-btn span { display: none; } /* Dölj text, visa bara ikoner på mobil */
    .toolbar-btn { padding: 12px 20px; }
}



















